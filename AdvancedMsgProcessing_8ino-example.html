<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Adeon: AdvancedMsgProcessing.ino</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Adeon
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('AdvancedMsgProcessing_8ino-example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">AdvancedMsgProcessing.ino</div></div>
</div><!--header-->
<div class="contents">
<p >This example demonstrates advanced processing of the incoming SMS message in the <a class="el" href="classAdeon.html">Adeon</a> format. The target is to edit users and parameter entries and set the values of defined parameters via SMS in case that the SMS has been sent by authorized user (from authorized phone number) with sufficient user rights.</p>
<div class="fragment"><div class="line">/**</div>
<div class="line"> *  </div>
<div class="line"> * @brief This example demonstrates advanced processing of the incoming SMS message in the </div>
<div class="line"> * Adeon format. The target is to edit users and parameter entries and set the values of defined </div>
<div class="line"> * parameters via SMS in case that the SMS has been sent by authorized user (from authorized phone number) </div>
<div class="line"> * with sufficient user rights.</div>
<div class="line"> *  </div>
<div class="line"> * For simplicity, real incoming SMS message(s) from real sender(s) is substituted with </div>
<div class="line"> * constant string(s).</div>
<div class="line"> * </div>
<div class="line"> *  Copyright (c) 2019 JSC electronics</div>
<div class="line"> *</div>
<div class="line"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</div>
<div class="line"> * you may not use this file except in compliance with the License.</div>
<div class="line"> * You may obtain a copy of the License at</div>
<div class="line"> *</div>
<div class="line"> *     https://www.apache.org/licenses/LICENSE-2.0</div>
<div class="line"> *</div>
<div class="line"> * Unless required by applicable law or agreed to in writing, software</div>
<div class="line"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</div>
<div class="line"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</div>
<div class="line"> * See the License for the specific language governing permissions and</div>
<div class="line"> * limitations under the License.</div>
<div class="line"> */</div>
<div class="line"> </div>
<div class="line">#include &quot;AdeonGSM.h&quot;</div>
<div class="line"> </div>
<div class="line">// Phone numbers of senders</div>
<div class="line">const char* sender1pn = &quot;420856954231&quot;;</div>
<div class="line">const char* sender2pn = &quot;420159753456&quot;;</div>
<div class="line">const char* sender3pn = &quot;420852741963&quot;;</div>
<div class="line">const char* sender4pn = &quot;420197346843&quot;;</div>
<div class="line"> </div>
<div class="line">// Incoming messages (in Adeon format)</div>
<div class="line">const char* testMsg1 = &quot;02606: WaterPump = 123;OpenDoor = 1;OpenGate = 0;AirCondition = 200;&quot;;</div>
<div class="line"> </div>
<div class="line">/** </div>
<div class="line"> * Definition of the names of the parameters, which value can be changed via SMS (in Adeon format).</div>
<div class="line"> * </div>
<div class="line"> * IMPORTANT NOTE: </div>
<div class="line"> * Parameter names of param(N)Name (param1Name, param2Name, ...) variables must be identical with the names of </div>
<div class="line"> * the parameters names sent in incoming message otherwise nothing is going to happen.</div>
<div class="line"> */</div>
<div class="line">const char* param1Name = &quot;OpenGate&quot;;</div>
<div class="line">const char* param2Name = &quot;OpenDoor&quot;;</div>
<div class="line">const char* param3Name = &quot;Pump&quot;;</div>
<div class="line">const char* param4Name = &quot;AirCondition&quot;;</div>
<div class="line"> </div>
<div class="line">Adeon adeon;</div>
<div class="line"> </div>
<div class="line">char msgBuf[MSG_BUFFER_LENGTH]; // incomming message buffer</div>
<div class="line">char pnBuf[LIST_ITEM_LENGTH];   // phone number buffer</div>
<div class="line"> </div>
<div class="line">// phone numbers</div>
<div class="line">char pn1[LIST_ITEM_LENGTH]; </div>
<div class="line">char pn2[LIST_ITEM_LENGTH]; </div>
<div class="line">char pn3[LIST_ITEM_LENGTH]; </div>
<div class="line">char pn4[LIST_ITEM_LENGTH]; </div>
<div class="line"> </div>
<div class="line">//parameter names of paramN variables must be identical with parameters names in incoming message - if not nothing going to happen</div>
<div class="line">char param1[LIST_ITEM_LENGTH]; </div>
<div class="line">char param2[LIST_ITEM_LENGTH]; </div>
<div class="line">char param3[LIST_ITEM_LENGTH]; </div>
<div class="line">char param4[LIST_ITEM_LENGTH]; </div>
<div class="line"> </div>
<div class="line">// function declarations</div>
<div class="line">void setDefaultValues(void);</div>
<div class="line">void numOfItems(void);</div>
<div class="line">void callbackFunction(uint16_t val);</div>
<div class="line">void userTest(void);</div>
<div class="line">void processMsg(void);</div>
<div class="line"> </div>
<div class="line">void setup() {</div>
<div class="line">    // Setup the Serial port. See http://arduino.cc/en/Serial/IfSerial</div>
<div class="line">    Serial.begin(9600);</div>
<div class="line">    while (!Serial) { ; // wait for serial port to connect. Needed for Leonardo only</div>
<div class="line">    }</div>
<div class="line">    delay(200);</div>
<div class="line"> </div>
<div class="line">    // initialize built-in LED</div>
<div class="line">    pinMode(LED_BUILTIN, OUTPUT);</div>
<div class="line">    digitalWrite(LED_BUILTIN, LOW);</div>
<div class="line"> </div>
<div class="line">    setDefaultValues();</div>
<div class="line"> </div>
<div class="line">    userTest();</div>
<div class="line">    paramTest();</div>
<div class="line">    numOfItems();</div>
<div class="line"> </div>
<div class="line">    // set incomming message sender number and text</div>
<div class="line">    strcpy(pnBuf, pn3);</div>
<div class="line">    strcpy(msgBuf, testMsg1);</div>
<div class="line"> </div>
<div class="line">    processMsg();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void loop() {</div>
<div class="line">    // insert your code here</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void setDefaultValues(void) {</div>
<div class="line">    // set default user phone numbers</div>
<div class="line">    strcpy(pn1, sender1pn);</div>
<div class="line">    strcpy(pn2, sender2pn);</div>
<div class="line">    strcpy(pn3, sender3pn);</div>
<div class="line">    strcpy(pn4, sender4pn);</div>
<div class="line"> </div>
<div class="line">    // set defualt parameter names</div>
<div class="line">    strcpy(param1, param1Name);</div>
<div class="line">    strcpy(param2, param2Name);</div>
<div class="line">    strcpy(param3, param3Name);</div>
<div class="line">    strcpy(param4, param4Name);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void numOfItems() {</div>
<div class="line">  Serial.print(&quot;NUM OF USERS: &quot;);</div>
<div class="line">  Serial.println(adeon.getNumOfUsers()); //number of saved users</div>
<div class="line"> </div>
<div class="line">  Serial.print(&quot;NUM OF PARAMS: &quot;);</div>
<div class="line">  Serial.println(adeon.getNumOfParams()); //number of saved parameters</div>
<div class="line">  Serial.println();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void callbackFunction(uint16_t val) {</div>
<div class="line">    //callback function which is called if value of the parameter is edited/changed</div>
<div class="line">    Serial.print(&quot;CALLBACK - ITEM VALUE: &quot;); </div>
<div class="line">    Serial.print(val);</div>
<div class="line">    Serial.println();</div>
<div class="line"> </div>
<div class="line">    digitalWrite(LED_BUILTIN, !digitalRead(LED_BUILTIN));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void userTest() {</div>
<div class="line">    //temporary pointer to string - it is used when source string need to be changed</div>
<div class="line">    char* tmpStr;</div>
<div class="line">    //add users with ADMIN, USER or HOST rights</div>
<div class="line">    adeon.addUser(pn1, ADEON_ADMIN);</div>
<div class="line">    adeon.addUser(pn2, ADEON_ADMIN);</div>
<div class="line">    adeon.addUser(pn3, ADEON_ADMIN);</div>
<div class="line">    adeon.addUser(pn4, ADEON_USER);</div>
<div class="line">    </div>
<div class="line">    //edit user1 phone number</div>
<div class="line">    tmpStr = adeon.editUserPhone(pn1, &quot;420222555666&quot;);</div>
<div class="line">    memset(pn1, 0, sizeof(pn1)); //delete array content</div>
<div class="line">    strcpy(pn1, tmpStr); //copy new string to array</div>
<div class="line"> </div>
<div class="line">    //edit user3 phone number</div>
<div class="line">    tmpStr = adeon.editUserPhone(pn3, &quot;420800205305&quot;);</div>
<div class="line">    memset(pn3, 0, sizeof(pn3)); //delete array content</div>
<div class="line">    strcpy(pn3, tmpStr); //copy new string to array</div>
<div class="line">    </div>
<div class="line">    //edit user3 rights</div>
<div class="line">    adeon.editUserRights(pn3, ADEON_HOST);</div>
<div class="line">    </div>
<div class="line">    //delete user2 </div>
<div class="line">    adeon.deleteUser(pn2);</div>
<div class="line"> </div>
<div class="line">    // TEST</div>
<div class="line">    Serial.print(&quot;IS USER &quot;);</div>
<div class="line">    Serial.print(pn1);</div>
<div class="line">    Serial.print(&quot; IN ADEON? &quot;);</div>
<div class="line">    adeon.isUserInAdeon(pn1) ? Serial.println(&quot;YES&quot;) : Serial.println(&quot;NO&quot;);</div>
<div class="line">    </div>
<div class="line">    Serial.print(&quot;IS USER &quot;);</div>
<div class="line">    Serial.print(pn2);</div>
<div class="line">    Serial.print(&quot; IN ADEON? &quot;);</div>
<div class="line">    adeon.isUserInAdeon(pn2) ? Serial.println(&quot;YES&quot;) : Serial.println(&quot;NO&quot;);</div>
<div class="line"> </div>
<div class="line">    Serial.print(&quot;IS USER &quot;);</div>
<div class="line">    Serial.print(pn3);</div>
<div class="line">    Serial.print(&quot; IN ADEON? &quot;);</div>
<div class="line">    adeon.isUserInAdeon(pn3) ? Serial.println(&quot;YES&quot;) : Serial.println(&quot;NO&quot;);</div>
<div class="line"> </div>
<div class="line">    Serial.print(&quot;GET USER RIGHTS LEVEL OF USER WITH NUBMER &quot;);</div>
<div class="line">    Serial.print(pn1);</div>
<div class="line">    Serial.print(&quot;: &quot;);</div>
<div class="line">    Serial.println(adeon.getUserRightsLevel(pn1)); //get user rights group</div>
<div class="line"> </div>
<div class="line">    Serial.print(&quot;GET USER RIGHTS LEVEL OF USER WITH NUBMER &quot;);</div>
<div class="line">    Serial.print(pn2);</div>
<div class="line">    Serial.print(&quot;: &quot;);</div>
<div class="line">    Serial.println(adeon.getUserRightsLevel(pn2)); //get user rights group</div>
<div class="line">    </div>
<div class="line">    Serial.print(&quot;GET USER RIGHTS LEVEL OF USER WITH NUBMER &quot;);</div>
<div class="line">    Serial.print(pn3);</div>
<div class="line">    Serial.print(&quot;: &quot;);</div>
<div class="line">    Serial.println(adeon.getUserRightsLevel(pn3)); //get user rights group</div>
<div class="line"> </div>
<div class="line">    adeon.printUsers();</div>
<div class="line">    Serial.println(&quot;USER TEST IS DONE\n&quot;);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void paramTest() {</div>
<div class="line">    //temporary pointer to string - it is used when source string need to be changed</div>
<div class="line">    char* tmpStr;</div>
<div class="line">    //add parameters</div>
<div class="line">    adeon.addParam(param1, 1);</div>
<div class="line">    adeon.addParam(param2, 2);</div>
<div class="line">    adeon.addParam(param4, 4);</div>
<div class="line">    adeon.setParamAccess(param4, ADEON_HOST);</div>
<div class="line">    </div>
<div class="line">    //add parameter with callback</div>
<div class="line">    adeon.addParamWithCallback(callbackFunction, param3, 3);</div>
<div class="line">    adeon.setParamAccess(param3, ADEON_USER);</div>
<div class="line">    </div>
<div class="line">    //edit parameter name</div>
<div class="line">    tmpStr = adeon.editParamName(param3, &quot;WaterPump&quot;);</div>
<div class="line">    memset(param3, 0, sizeof(param3)); //delete array content</div>
<div class="line">    strcpy(param3, tmpStr); //copy new string to array</div>
<div class="line">    </div>
<div class="line">    //edit parameter value</div>
<div class="line">    adeon.editParamValue(param3, 100);</div>
<div class="line">    </div>
<div class="line">    //delete parameter </div>
<div class="line">    adeon.deleteParam(param2);</div>
<div class="line"> </div>
<div class="line">    Serial.print(&quot;IS PARAMETER &quot;);</div>
<div class="line">    Serial.print(param1);</div>
<div class="line">    Serial.print(&quot; IN ADEON? &quot;);</div>
<div class="line">    (adeon.isParamInAdeon(param1)) ? Serial.println(&quot;YES&quot;) : Serial.println(&quot;NO&quot;);</div>
<div class="line"> </div>
<div class="line">    Serial.print(&quot;IS PARAMETER &quot;);</div>
<div class="line">    Serial.print(param2);</div>
<div class="line">    Serial.print(&quot; IN ADEON? &quot;);</div>
<div class="line">    (adeon.isParamInAdeon(param2)) ? Serial.println(&quot;YES&quot;) : Serial.println(&quot;NO&quot;);</div>
<div class="line">    </div>
<div class="line">    Serial.print(&quot;GET PARAMETER &quot;);</div>
<div class="line">    Serial.print(param3);</div>
<div class="line">    Serial.print(&quot; VALUE: &quot;);</div>
<div class="line">    Serial.println(adeon.getParamValue(param3)); //get parameter value</div>
<div class="line"> </div>
<div class="line">    adeon.printParams();</div>
<div class="line">    Serial.println(&quot;PARAMETER TEST IS DONE\n&quot;);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void processMsg() {</div>
<div class="line">  Serial.println(&quot;\nPROCESSING INCOMMING MSG.&quot;);</div>
<div class="line">    //simulation of incomming message </div>
<div class="line">    if(adeon.isAdeonReady()) {</div>
<div class="line">        if (adeon.isUserInAdeon(pnBuf)) {</div>
<div class="line">            Serial.println(&quot;PHONE NUMBER IS AUTHORIZED&quot;);</div>
<div class="line">            //parameters are parsed and their values are saved into list</div>
<div class="line">            adeon.parseBuf(msgBuf, adeon.getUserRightsLevel(pnBuf));</div>
<div class="line">            adeon.printParams();</div>
<div class="line">        }</div>
<div class="line">        else {</div>
<div class="line">            Serial.println(&quot;PHONE NUMBER IS NOT AUTHORIZED\n&quot;);</div>
<div class="line">        }</div>
<div class="line">    } </div>
<div class="line">    else Serial.println(&quot;ADEON IS NOT READY TO PROCCESS NEW MESSAGE.&quot;);</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
